#Разработка и Тестирование Программного Модуля

## 1. Анализ Технического Задания и Спецификация Модуля

Программный модуль предназначен для **учета заявок на ремонт бытовой техники**.

| Характеристика | Описание |
| :--- | :--- |
| **Название Модуля** | Система Учета Заявок (RepairTracker) |
| **Основная Функция** | Регистрация, отслеживание статуса, назначение мастера и формирование отчетов по заявкам на ремонт. |
| **Технологии** | Python, PostgreSQL (через `psycopg2`), PyQt5 (для GUI). |

### 1.1. Входные и Выходные Данные

| Тип Данных | Входные Данные | Выходные Данные |
| :--- | :--- | :--- |
| **Заявка** | `client_id`, `type_id`, `model`, `description`, `serial_number`. | `request_id`, `status_id`, `master_id`, `date_created`, `cost`. |
| **Отчетность** | Диапазон дат (для расчета среднего времени ремонта). | Среднее время ремонта (в часах), количество выполненных заявок, отчеты по статусам и загрузке мастеров. |
| **Пользователь** | `login`, `password`. | `user_id`, `role`, `fio`. |

## 2. Алгоритм Решения

Основной алгоритм работы системы включает в себя жизненный цикл заявки: **Создание → Назначение → Выполнение → Завершение/Отмена**.

### 2.1. Детализированный Алгоритм: Расчет Среднего Времени Ремонта

В соответствии с заданием, детализирован алгоритм расчета среднего времени ремонта. Он реализован в функции `calculate_average_repair_time` (см. `main_app.py` [1]).

1. **Вход:** Необязательные параметры `start_date` и `end_date` для фильтрации.
2. **Запрос:** Выбираются все заявки со статусом "Выполнена" (`status_name = 'Выполнена'`) в заданном диапазоне дат. Извлекаются поля `date_start_work` и `date_completed`.
3. **Инициализация:** `total_time_seconds = 0`, `completed_count = 0`.
4. **Итерация:** Для каждой выполненной заявки:
    a. Проверяется наличие обеих дат (`date_start_work` и `date_completed`).
    b. Рассчитывается разница времени (`time_delta = date_completed - date_start_work`).
    c. Разница в секундах добавляется к `total_time_seconds`.
    d. `completed_count` увеличивается на 1.
5. **Расчет Среднего:** Если `completed_count > 0`, рассчитывается `average_time_seconds = total_time_seconds / completed_count`.
6. **Конвертация:** Среднее время конвертируется в часы (`average_time_hours = average_time_seconds / 3600`).
7. **Выход:** Возвращается `average_time_hours` и `completed_count`.

## 3. Разработка Интерфейса и Реализация Алгоритма

### 3.1. Интерфейс

Интерфейс разработан с использованием библиотеки **PyQt5** (файл `gui.py` [2]).

- **Единый Стиль:** Приложение использует стандартные виджеты PyQt5, обеспечивая согласованный внешний вид.
- **Навигация:** Главное окно (`MainWindow`) содержит меню и кнопки для перехода к различным функциям (создание заявки, просмотр отчетов, управление пользователями).
- **Заголовки и Уведомления:** Используются стандартные окна сообщений (`QMessageBox`) с соответствующими заголовками и пиктограммами для информирования пользователя об ошибках, предупреждениях и успешных операциях.

### 3.2. Соответствие Гайдлайну и Комментирование

- **Соглашение об Именовании:** В коде на Python (`main_app.py`, `gui.py`) используется стиль **`snake_case`** для именования функций, переменных и методов, что соответствует стандартам Python (PEP 8).
- **Комментарии:** Комментарии используются для пояснения неочевидных фрагментов кода, например, сложных SQL-запросов или логики расчета в `calculate_average_repair_time`. Очевидные действия не комментируются, что соответствует требованию "Хороший код воспринимается как обычный текст".

## 4. Программные Обработки Исключительных Ситуаций и Отладка

### 4.1. Обработка Исключений

Обработка исключительных ситуаций реализована на двух уровнях:

1. **Уровень Базы Данных (`database_module.py` [3]):**
    - Используются блоки `try-except` для перехвата ошибок подключения (`OperationalError`) и ошибок выполнения SQL-запросов.
    - При ошибке выводится информативное сообщение в консоль, и функция возвращает `None` или `False`, предотвращая крах приложения.
2. **Уровень Интерфейса (`gui.py` [2]):**
    - Используются `QMessageBox` для уведомления пользователя о запрещенных действиях (например, попытка просмотра отчета без прав Менеджера/Администратора) или ошибках (например, ошибка подключения к БД).
    - Предупреждения о неотвратимых операциях (например, резервное копирование) также реализованы через диалоговые окна.

### 4.2. Отладка и Тестирование

- **Отладка:** Отладка проводилась с использованием инструментальных средств Python (встроенный отладчик или print-отладка), что позволило проверить корректность выполнения SQL-запросов и логики расчета.
- **Функциональное Тестирование:** Проведено тестирование ключевых функций модуля:
    - **Тест 1 (Расчет):** Проверка функции `calculate_average_repair_time` на наборе данных, где известны даты начала и завершения работ.
    - **Тест 2 (Отчет):** Проверка функции `get_status_report` для подтверждения корректного подсчета заявок по каждому статусу.
    - **Тест 3 (Интерфейс):** Проверка авторизации и ограничения доступа к отчетам для пользователей с ролью "Мастер" или "Оператор".

